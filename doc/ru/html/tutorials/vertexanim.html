<HTML>
<HEAD>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<TITLE>Вершинная анимация</TITLE>
<LINK href="../data/style.css" type=text/css rel=stylesheet>
</HEAD>
<BODY>

<DIV ALIGN=justify>

<H1 class=pagetitle>Урок 8<BR>Вершинная анимация</H1>

<A><B>Уровень:</B> начинающий</A>
<BR><A><B>Версия Xtreme3D:</B> 3.0.x</A>
<BR><A><B>Автор урока:</B> Gecko</A><A class=ntext>
<BR>
<BR>Объект Freeform предназначен, в основном, для неодушевленных предметов. Обычно это элементы декорации, 
транспортные средства, различные интерактивные объекты и т.д. Если мы хотим заселить наш виртуальный мир 
живыми существами, нам не обойтись без объектов Actor. Название говорит само за себя: актер - это живой 
персонаж. В Xtreme3D Актеры представляют собой анимированные модели. А анимация, как известно, бывает двух 
типов - вертексная и скелетная. На этом уроке мы рассмотрим вертексную анимацию.
<BR>Вертексная (или вершинная) анимация характерна тем, что для формирования анимационной последовательности 
движок перемещает каждую вершину модели от одной позиции к другой. Этот тип анимации впервые был применен в 
Quake, и с тех пор форматы моделей серии Quake (MD2, MD3) стали своего рода стандартом во всех популяных 
движках. Xtreme3D предоставляет полную поддержку MD2 и MD3. Разница между ними заключается в 
том, что MD2 хранит всю модель целиком в одном файле, а MD3 - в трех (отдельно голова, туловище и ноги). 
При помощи специальных матриц туловище синхронизируется с ногами, а голова - с туловищем. Это было сделано 
для того, чтобы анимировать туловище и ноги по отдельности. Например, во время стрельбы персонаж может как 
бежать, так и идти медленно, а то и просто стоять на месте.
<BR>
<BR>На этом уроке мы рассмотрим вертексную анимацию с форматом MD2. Актер из модели MD2 создается так:
<BR>
<BR><A>actor = </A><A class=func2link href=../functions/actor.htm#ActorCreate>ActorCreate</A><A>('model.md2', matlib, matlib, <B>global.</B>scene);</A>
<BR>
<BR>Иногда после загрузки модели оказывается, что она неправильно повернута. Это происходит потому, что в 
разных редакторах направление осей трактуется по-разному. Обычно "меняются местами" оси Y и Z. Вершины модели 
записаны так, что ее вектор Up направлен вдоль оси Z (в DirectX-приложениях это означает "вверх"), и, поскольку 
за направление "вверх" в Xtreme3D отвечает ось Y, а не Z, получается, что модель повернута на -90 градусов по оси X. 
Мы можем исправить это недоразумение несколькими способами. Самый простой - просто повернуть ее обратно:
<BR>
<BR><A class=func2link href=../functions/object.htm#ObjectPitch>ObjectPitch</A><A>(actor, 90);</A>
<BR>
<BR>Но в некоторых случаях этого недостаточно. Поворачивая модель, мы также поворачиваем ее локальную систему 
координат. Это значит, что ее вектор Direction теперь указывает вдоль оси Y, а не Z, как должно быть. Если мы 
теперь переместим модель при помощи <A class=func2link href=../functions/object.htm#ObjectMove>ObjectMove</A>, 
она сдвинется вверх, а не вперед. 
Можно, конечно, вместо <A class=func2link href=../functions/object.htm#ObjectMove>ObjectMove</A> 
использовать <A class=func2link href=../functions/object.htm#ObjectStrafe>ObjectStrafe</A>, но это сделает 
программу менее аккуратной, да и запутаться так недолго. Гораздо лучше сначала поместить Актера в потомки Манекену, 
а уже потом поворачивать. И, соответственно, для перемещения использовать Манекен, а не Актера. Код будет следующий:
<BR>
<BR><A>player = </A><A class=func2link href=../functions/dummycube.htm#DummycubeCreate>DummycubeCreate</A><A>(<B>global.</B>scene);</A>
<BR><A>actor = </A><A class=func2link href=../functions/actor.htm#ActorCreate>ActorCreate</A><A>('model.md2', matlib, matlib, player);</A>
<BR><A class=func2link href=../functions/object.htm#ObjectPitch>ObjectPitch</A><A>(actor, 90);</A>
<BR>
<BR>Формат MD2 предусматривает разделение всех кадров анимации на отдельные группы. Это сделано для того, чтобы 
отделить, скажем, анимацию бега от анимации прыжка. По умолчанию Xtreme3D воспроизводит все кадры один за другим, 
не обращая внимания на это разделение. Но мы можем в любое время переключиться на желаемую анимацию:
<BR>
<BR><A class=func2link href=../functions/actor.htm#ActorSwitchToAnimation>ActorSwitchToAnimation</A><A>(actor, 1, </A><A class=constant>false</A><A>);</A>
<BR>
<BR>И тогда будет воспроизводиться только группа кадров под номером 1. Третий параметр этой функции отвечает за плавность 
смены анимации: если установить его в <A class=constant>true</A>, то переключение будет постепенным.
<BR>Примерно то же самое делает функция, указывающая диапазон кадров для воспроизведения:
<BR>
<BR><A class=func2link href=../functions/actor.htm#ActorSetAnimationRange>ActorSetAnimationRange</A><A>(actor, 10, 20);</A>
<BR>
<BR>Нетрудно догадаться, что будет проигран только промежуток между десятым и двадцатым кадрами. Правда, эти две 
функции имеют одно важное различие. 
<A class=func2link href=../functions/actor.htm#ActorSwitchToAnimation>ActorSwitchToAnimation</A> каждый раз при вызове переключает 
воспроизведение на первый кадр заданной группы, а <A class=func2link href=../functions/actor.htm#ActorSetAnimationRange>ActorSetAnimationRange</A> 
этого не делает (если заданный диапазон уже воспроизводится). Поэтому <A class=func2link href=../functions/actor.htm#ActorSetAnimationRange>ActorSetAnimationRange</A> можно вызывать многократно - например, внутри цикла, что в некоторых ситуациях 
оказывается весьма полезным.
<BR>
<BR>По умолчанию анимация воспроизводится циклически - то есть, при достижении последнего кадра, воспроизведение начинается заново. 
Для большинства случаев это то, что нужно (например, анимация ходьбы или бега всегда зациклена). Но мы можем указать и другие режимы воспроизведения:
<BR>
<BR><A class=func2link href=../functions/actor.htm#ActorSetAnimationMode>ActorSetAnimationMode</A><A>(actor, aam);</A>
<BR>
<BR>Вместо aam подставляется одна из следующих констант:
<BR>
<BR><A class=constant>aamNone</A> - анимация не воспроизводится;
<BR><A class=constant>aamPlayOnce</A> - анимация воспроизводится один раз и останавливается при достижении конечного кадра. Этот режим иногда называют "one shot";
<BR><A class=constant>aamLoop</A> - анимация повторяется циклически (по умолчанию);
<BR><A class=constant>aamBounceForward</A> - анимация повторяется циклически вперед до конечного кадра, затем в обратную сторону до начального кадра, затем опять вперед и так далее. Этот режим иногда называют "пинг-понг".
<BR><A class=constant>aamBounceBackward</A> - то же самое, но в обратную сторону;
<BR><A class=constant>aamLoopBackward</A> - анимация повторяется циклически в обратную сторону.
<BR>
<BR>Наконец, существует также возможность отключить линейную интерполяцию между кадрами:
<BR>
<BR><A class=func2link href=../functions/actor.htm#ActorSetFrameInterpolation>ActorSetFrameInterpolation</A><A>(actor,</A><A class=constant>false</A><A>);</A>
<BR>
<BR>При этом кадры будут сменять друг друга резко, без плавного "перетекания". Это может быть полезным, например, в гонках, где кузов автомобиля может быть деформирован - в разных кадрах вершинной анимации можно хранить разные варианты повреждений. 
</A>

</DIV>

</BODY>
</HTML>
