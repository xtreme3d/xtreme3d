<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Tutorial 16. Creating water</title>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    <meta charset="windows-1251">
    <meta name="author" content="Gecko">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="../sakura.css" inline>
    <link rel="stylesheet" type="text/css" href="../github.css" inline>
</head>
<body>
<h1 id="16">Урок 16. Создание воды</h1>
<p>Реалистичная анимированная вода является своего рода визитной карточкой Xtreme3D. Это и в самом деле красивый спецэффект, позволяющий добиться высокой степени реализма сцены. Однако использовать воду надо осторожно, так как вычисления, связанные с ней, довольно ресурсоемки.</p>
<p>Вода в Xtreme3D представляет собой плоскую поверхность, разбитую на определенное количество квадратов, на которых возникают концентрические волновые возмущения - получается эффект "дождя". Также поддерживаются линейные волны, как в океане - они параллельны, вычисляются по синусоиде и равномерно движутся по всей поверхности воды. Сама по себе вода - всего лишь геометрия и никакими свойствами жидкости, кроме волн, не обладает. Поэтому все остальные эффекты, усиливающие впечатление от воды (отражение, брызги, физику плавающих объектов и т.д.) вам придется писать самостоятельно.</p>
<p>Код создания воды выглядит следующим образом:</p>
<pre class="gml language-gml"><code class="hljs gml language-gml">water = WaterCreate(<span class="hljs-symbol">global</span>.scene);
WaterSetResolution(water, <span class="hljs-number">128</span>);
WaterSetRainTimeInterval(water, <span class="hljs-number">1000</span>);
WaterSetRainForce(water, <span class="hljs-number">1000</span>);
WaterSetViscosity(water, <span class="hljs-number">0.95</span>);
WaterSetElastic(water, <span class="hljs-number">10</span>);
ObjectSetPosition(water, <span class="hljs-number">0</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">0</span>);
ObjectSetScale(water, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);
</code></pre>
<p>Объект Water имеет несколько важных свойств:</p>
<p><strong>Resolution</strong> (разрешение). Число полигонов по стороне сетки. Геометрия воды строится из квадратов в сетке, поэтому общее число полигонов равно R2, где R - значение Resolution. Ясно, что, чем выше это значение, тем выше качество воды, и, соответственно, ниже скорость ее работы. Значение по умолчанию: 64.</p>
<p><strong>Rain time interval</strong> (временной интервал дождя). Эффект "дождя", когда поверхность анимируется, создавая в случайных местах сетки волновые возмущения. Данная опция задает длину паузы в миллисекундах между двумя возмущениями. Значение по умолчанию: 500. Максимальное значение: 1000000. Минимальное значение: 0 (нет дождя).</p>
<p><strong>Rain Force</strong> (сила дождя). Интенсивность возмущений; чем меньше это значение, тем быстрее волны "затухают". Значение по умолчанию: 5000. Максимальное значение: 1000000. Минимальное значение: 0.</p>
<p><strong>Viscosity</strong> (вязкость). Амплитуда возмущений; фактически, максимальная высота волн: чем меньше это значение, тем гелеобразнее жидкость. Значение по умолчанию: 0.99. Максимальное значение: 1. Минимальное значение: 0.</p>
<p><strong>Elastic</strong> (эластичность). Скорость распространения возмущений. В реальном мире это свойство зависит от плотности вещества (например, у ртути плотность гораздо выше, чем у воды, поэтому волны распространяются быстрее). Значение по умолчанию: 10.</p>
<p>Еще один момент: для создания воды требуется маска, определяющая форму поверхности. Маска в данном случае - материал с монохромным изображением, где черные точки означают отсутствие воды, белые - наличие. Таким образом, мы можем создать, например, круглый бассейн.</p>
<pre class="gml language-gml"><code class="hljs gml language-gml">MaterialCreate(<span class="hljs-string">&quot;mMask&quot;</span>, <span class="hljs-string">&quot;watermask.bmp&quot;</span>);
WaterSetMask(water, <span class="hljs-string">&quot;mMask&quot;</span>);
</code></pre>
</body>
</html>
