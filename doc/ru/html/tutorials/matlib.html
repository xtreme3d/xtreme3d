<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Tutorial 5. Material library</title>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    <meta charset="windows-1251">
    <meta name="author" content="Gecko">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="../sakura.css" inline>
    <link rel="stylesheet" type="text/css" href="../github.css" inline>
</head>
<body>
<h1 id="5">Урок 5. Библиотека материалов</h1>
<p>Одна из самых замечательных особенностей Xtreme3D — использование библиотеки материалов. Материал - это набор параметров, определяющих внешний вид объекта. В этот набор входят значения цвета, прозрачности, текстуры, типа смешивания и т.д. Понятие материала в Xtreme3D куда более фундаментально, чем во многих других движках. Очень часто под материалом понимается текстура, но в Xtreme3D материал может и не иметь текстуры. В других случаях система материалов бывает непродуманной или неполной, чего нельзя сказать о Xtreme3D.</p>
<p>Материал создается один раз и может быть применен к любому количеству объектов, поддерживающих материалы. Изменение параметров материала коснется всех объектов, использующих этот материал. Такой принцип дает ощутимые выгоды (экономия памяти, объема кода, времени и труда программиста), хотя может вызвать и определенные неудобства (например, если необходимо, чтобы изменения параметров материала коснулись только одного конкретного объекта). Материал в Xtreme3D имеет уникальное имя, по которому осуществляется изменение параметров. Имя задается строковым значением, например <code>"mGround"</code>.</p>
<p>Библиотекой материалов (Material Library) называется специальная конструкция, содержащая список материалов. Библиотека может быть активной или неактивной. В первом случае в нее можно добавлять материалы, настраивать их и применять к объектам. Во втором случае это невозможно. Поскольку разные библиотеки могут содержать материалы с одинаковыми именами, нельзя сделать активными две или более библиотеки одновременно.</p>
<p>Смысл в использовании нескольких библиотек материалов заключается в возможности определять для них индивидуальные пути к текстурам. Эти пути учитываются при загрузке моделей, использующих внешние файлы текстур. По умолчанию библиотеки ищут текстуры в рабочей директории игры. Разумеется, хранить их там — не самая лучшая идея. Несомненно, лучше распределить их по отдельным папкам. Например, если у вас есть три папки с тремя разными моделями уровней, то можно будет создать для каждой из них свою библиотеку материалов и назначить им пути к текстурам, соответствующие искомым папкам.</p>
<p>Существует поистине огромное количество разнообразных настроек материалов. Кроме того, материалы позволяют применять к ним шейдеры, "фотографировать" в них картинки с экрана или с камеры, а также хранить различные невизуальные данные, например, маски и карты высот. Охватить в одной статье все возможности, которыми располагает система материалов Xtreme3D, просто нереально. Поэтому мы рассмотрим только самые основные: цвет, текстуру и несколько других.</p>
<p>Сначала создается и активируется библиотека материалов:</p>
<pre class="d language-d"><code class="hljs d language-d">matlib = MaterialLibraryCreate();
MaterialLibraryActivate(matlib);
</code></pre>
<p>Теперь можно создавать сами материалы:</p>
<pre class="d language-d"><code class="hljs d language-d">MaterialCreate(<span class="hljs-string">&quot;mTexture&quot;</span>, <span class="hljs-string">&quot;texture.jpg&quot;</span>);
</code></pre>
<p>Эта функция одновременно создает материал и присваивает ему текстуру из файла. Xtreme3D поддерживает форматы BMP, JPG, PNG, TGA, DDS. Рекомендуется использовать текстуры со стороной, равной 128, 256, 512 и прочим степеням двойки. Текстура не обязательно должна быть квадратной.</p>
<p>Вы можете создать материал без текстуры, просто оставив строку имени файла пустой:</p>
<pre class="d language-d"><code class="hljs d language-d">MaterialCreate(<span class="hljs-string">&quot;mColor&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);
</code></pre>
<p>В этом случае можно задать цвет материала. Проще всего это сделать функцией</p>
<pre class="d language-d"><code class="hljs d language-d">MaterialSetDiffuseColor(<span class="hljs-string">&quot;mColor&quot;</span>, c_red, <span class="hljs-number">1</span>);
</code></pre>
<p>Цвет вы можете передать встроенными константами GML (с<em>red, c</em>yellow, c<em>green и др.), функциями make</em>color<em>rgb(r, g, b) или make</em>color_hsv(h, s, v) для цветовых моделей RGB и HSV, соответственно, а также в обратном шестнадцатиричном формате, например, <code>$0000FF</code> означает красный.</p>
<p>Кроме цвета, функция <code>MaterialSetDiffuseColor</code> задает значение прозрачности — альфа — лежащее в промежутке от 0 до 1. Альфа в нашем случае равно 1 (полная непрозрачность).</p>
<p>Строго говоря, <code>MaterialSetDiffuseColor</code> задает только один из компонентов цвета материала, а всего их четыре - Ambient, Diffuse, Specular и Emission. Такое разделение связано с тем, что участки поверхности с различным уровнем освещенности могут иметь разный цвет. Ambient задает общий оттенок материала, не зависящий от освещения (цвет теневой стороны), Diffuse - цвет освещенной стороны, Specular - цвет блика, Emission — цвет имитации самосвечения. Более того, сами источники освещения также имеют собственные компоненты Ambient, Diffuse и Specular, и это делает цвет объектов еще более сложным и многообразным.</p>
<p>Вы можете отключить для материала освещение (и, заодно, влияние тумана, о котором пойдет речь чуть позже):</p>
<pre class="gml language-gml"><code class="hljs gml language-gml">MaterialSetOptions(<span class="hljs-string">&quot;mColor&quot;</span>, <span class="hljs-symbol">true</span>, <span class="hljs-symbol">true</span>);
</code></pre>
<p>Первый параметр отвечает за отключение тумана, второй - за отключение освещения.</p>
<p>Применить созданный материал к объекту очень просто:</p>
<pre class="gml language-gml"><code class="hljs gml language-gml">ObjectSetMaterial(object, <span class="hljs-string">&quot;mTexture&quot;</span>);
</code></pre>
<p>Кстати, вернемся к материалу с текстурой. С этой текстурой можно творить удивительные вещи! Например, изменение режима проецирования на сферический сделает материал похожим на отражение на металле: </p>
<pre class="gml language-gml"><code class="hljs gml language-gml">MaterialSetTextureMappingMode(<span class="hljs-string">&quot;mTexture&quot;</span>, tmmSphere);
</code></pre>
<p>А чтобы многократно повторить текстуру на поверхности объекта, меняется ее масштаб:</p>
<pre class="gml language-gml"><code class="hljs gml language-gml">MaterialSetTextureScale(<span class="hljs-string">&quot;mTexture&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
</code></pre>
<p>При этом текстура повторится десять раз.</p>
<p>В качестве самостоятельной работы попробуйте создать и наложить материалы на планеты из предыдущего урока про иерархию. В качестве текстур можно использовать реальные карты поверхности Земли и Луны. А Солнце можно оставить без текстуры и сделать просто желтым. Вспомните также, как создается источник освещения и сделайте его дочерним для Солнца, чтобы оно излучало свет (в этом случае стоит отключить освещение для его материала).</p>
</body>
</html>
