<HTML>
<HEAD>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<TITLE>Создание неба</TITLE>
<LINK href="../data/style.css" type=text/css rel=stylesheet>
</HEAD>
<BODY>

<DIV ALIGN=justify>

<H1 class=pagetitle>Урок 14<BR>Создание неба</H1>

<A><B>Уровень:</B> средний<A>
<BR><A><B>Версия Xtreme3D:</B> 3.0.x</A>
<BR><A><B>Автор урока:</B> Gecko</A><A class=ntext>
<BR>
<BR>Во многих играх важной составляющей графики и геймплея является плавная смена дня и ночи (например, в RPG и играх в стиле GTA). В Xtreme3D такую функциональность обеспечивает объект Skydome, что в дословном переводе означает "небесный купол", "небосвод". Это сферическая форма, окружающая сцену и меняющая цвет в зависимости от времени суток. На куполе в буквальном смысле "подвешены" солнце и звезды. Солнце плавно ходит по небу: когда оно опускается к горизонту, мы наблюдаем закат. А потом небо темнеет и наступает ночь. Звезды мерцают, как настоящие. Единственный минус - нет облаков. Их придется делать самостоятельно. Это, вероятно, было допущено для того, чтобы не лишать разработчика возможности сделать, например, авиасимулятор: чтобы можно было как опуститься до самой земли, так и подняться к облакам и видеть их с близкого расстояния. 
<BR>
<BR>Цвет неба в skydome составлен из трех компонентов: Deep, Haze, Night и Sky. 
<BR>Deep - цвет так называемого надира - точки, противоположной зениту; она расположена у нас под ногами. Обычно в реальной жизни надир увидеть 
невозможно, земля мешает :) Но цвет этой точки важен, так как он определяет, с каким оттенком смешивается цвет неба по мере ухода за линию горизонта.
<BR>Haze - цвет линии горизонта. Обычно соответствует цвету тумана.
<BR>Sky - цвет зенита. В этот цвет окрашен весь небесный купол до линии горизонта.
<BR>Night - цвет ночи. Когда солнце уходит за горизонт, этим цветом постепенно заполняются все компоненты неба, кроме Deep. Чаще всего это черный или темно-синий, хотя могут быть и другие варианты.
<BR><BR>
<img src=../data/skydomecomponents.png align="center">
<BR>
<BR>Ниже приведен код, который создает небо:
<BR>
<BR><A>sky = </A><A class=func2link href=../functions/skydome.htm#SkydomeCreate>SkydomeCreate</A><A>(24, 48, <B>global</B>.back);</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeSetOptions>SkydomeSetOptions</A><A>(sky, true, true);</A>
<BR><A class=func2link href=../functions/object.htm#ObjectRotate>ObjectRotate</A><A>(sky, 90, 0, 0);</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeSetNightColor>SkydomeSetNightColor</A><A>(sky, </A><A class=type>make_color_rgb</A><A>(0, 0, 180));</A>
<BR><A>angle = 0;</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeSetSunElevation>SkydomeSetSunElevation</A><A>(sky, angle);</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddRandomStars>SkydomeAddRandomStars</A><A>(sky, 50, </A><A class=constant>c_white</A><A>);</A> 
<BR>
<BR>Чтобы солнце двигалось по небу, нужно каждый шаг времени менять угол, на котором оно находится по отношению к горизонту. Угол в 90 градусов соответствует зениту, -90 - надиру.
<BR>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeSetSunElevation>SkydomeSetSunElevation</A><A>(sky, angle);</A>
<BR><A>angle = angle + 1.0 * dt;</A>
<BR>
<BR>Можно также создать реалистичное звездное небо с привычными нам созвездиями, хотя это не так просто, как может показаться. Для этого вам нужно понимать астрономические координаты. В Xtreme3D положение звезды на небе задается во второй экваториальной системе координат, которая включает две величины - прямое восхождение (right ascension) и склонение (declination). При этом обе величины задаются в градусах, хотя в астрономии прямое восхождение традиционно измеряется в часах, минутах и секундах (1 угловой час равен 360 / 24 = 15 градусам). Чтобы упростить перевод этих единиц в градусы, в Xtreme3D SDK есть скрипт RightAscension(hours, minutes, seconds). Также имеется скрипт Declination(degrees, minutes, seconds), при помощи которого можно получить единое вещественное значение из градусов, угловых минут и угловых секунд. 
<BR>
<BR>Вот пример создания всем известного Ковша - семи главных звезд Большой Медведицы (координаты я взял из Википедии):
<BR>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(11, 3, 44), Declination(61, 45, 0), 1.79, </A><A class=constant>c_white</A><A>); </A><A class=green>// Дубхе</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(11, 1, 50), Declination(56, 22, 57), 2.37, </A><A class=constant>c_white</A><A>); </A><A class=green>// Мерак</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(11, 53, 50), Declination(53, 41, 41), 2.44, </A><A class=constant>c_white</A><A>); </A><A class=green>// Фекда</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(12, 15, 25), Declination(57, 01, 57), 3.31, </A><A class=constant>c_white</A><A>); </A><A class=green>// Мегрец</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(12, 54, 0), Declination(55, 57, 35), 1.77, </A><A class=constant>c_white</A><A>); </A><A class=green>// Алиот</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(13, 23, 55), Declination(54, 55, 31), 2.27, </A><A class=constant>c_white</A><A>); </A><A class=green>// Мицар</A>
<BR><A class=func2link href=../functions/skydome.htm#SkydomeAddStar>SkydomeAddStar</A><A>(sky, RightAscension(13, 47, 32), Declination(49, 18, 48), 1.86, </A><A class=constant>c_white</A><A>); </A><A class=green>// Алькаид</A>
<BR>
<BR>Удобнее будет, конечно, создать что-то вроде звездного каталога в файле и читать его при загрузке, создавая звезды процедурно.
</A>

</DIV>

</BODY>
</HTML>
