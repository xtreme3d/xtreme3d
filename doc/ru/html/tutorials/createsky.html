<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Tutorial 14. Creating sky</title>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    <meta charset="windows-1251">
    <meta name="author" content="Gecko">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="../sakura.css" inline>
    <link rel="stylesheet" type="text/css" href="../github.css" inline>
</head>
<body>
<h1 id="14">Урок 14. Создание неба</h1>
<p>Во многих играх важной составляющей графики и геймплея является плавная смена дня и ночи (например, в RPG и играх в стиле GTA). В Xtreme3D такую функциональность обеспечивает объект Skydome, что в дословном переводе означает "небесный купол", "небосвод". Это сферическая форма, окружающая сцену и меняющая цвет в зависимости от времени суток. На куполе в буквальном смысле "подвешены" солнце и звезды. Солнце плавно ходит по небу: когда оно опускается к горизонту, мы наблюдаем закат. А потом небо темнеет и наступает ночь. Звезды мерцают, как настоящие. Единственный минус - нет облаков. Их придется делать самостоятельно. Это, вероятно, было допущено для того, чтобы не лишать разработчика возможности сделать, например, авиасимулятор: чтобы можно было как опуститься до самой земли, так и подняться к облакам и видеть их с близкого расстояния.</p>
<p>Цвет неба в skydome составлен из трех компонентов: Deep, Haze, Night и Sky.</p>
<p>Deep - цвет так называемого надира - точки, противоположной зениту; она расположена у нас под ногами. Обычно в реальной жизни надир увидеть невозможно, земля мешает :) Но цвет этой точки важен, так как он определяет, с каким оттенком смешивается цвет неба по мере ухода за линию горизонта.</p>
<p>Haze - цвет линии горизонта. Обычно соответствует цвету тумана.</p>
<p>Sky - цвет зенита. В этот цвет окрашен весь небесный купол до линии горизонта.</p>
<p>Night - цвет ночи. Когда солнце уходит за горизонт, этим цветом постепенно заполняются все компоненты неба, кроме Deep. Чаще всего это черный или темно-синий, хотя могут быть и другие варианты.</p>
<p><img src="../data/skydomecomponents.png" alt="skydomecomponents" /></p>
<p>Ниже приведен код, который создает небо:</p>
<pre class="gml language-gml"><code class="hljs gml language-gml">sky = SkydomeCreate(<span class="hljs-number">24</span>, <span class="hljs-number">48</span>, <span class="hljs-symbol">global</span>.back);
SkydomeSetOptions(sky, <span class="hljs-symbol">true</span>, <span class="hljs-symbol">true</span>);
ObjectRotate(sky, <span class="hljs-number">90</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
SkydomeSetNightColor(sky, <span class="hljs-built_in">make_color_rgb</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">180</span>));
angle = <span class="hljs-number">0</span>;
SkydomeSetSunElevation(sky, angle);
SkydomeAddRandomStars(sky, <span class="hljs-number">50</span>, <span class="hljs-symbol">c_white</span>);
</code></pre>
<p>Чтобы солнце двигалось по небу, нужно каждый шаг времени менять угол, на котором оно находится по отношению к горизонту. Угол в 90 градусов соответствует зениту, -90 - надиру. </p>
<pre class="gml language-gml"><code class="hljs gml language-gml">SkydomeSetSunElevation(sky, angle);
angle = angle + <span class="hljs-number">1.0</span> * dt;
</code></pre>
<p>Можно также создать реалистичное звездное небо с привычными нам созвездиями, хотя это не так просто, как может показаться. Для этого вам нужно понимать астрономические координаты. В Xtreme3D положение звезды на небе задается во второй экваториальной системе координат, которая включает две величины - прямое восхождение (right ascension) и склонение (declination). При этом обе величины задаются в градусах, хотя в астрономии прямое восхождение традиционно измеряется в часах, минутах и секундах (1 угловой час равен 360 / 24 = 15 градусам). Чтобы упростить перевод этих единиц в градусы, в Xtreme3D SDK есть скрипт <code>RightAscension(hours, minutes, seconds)</code>. Также имеется скрипт <code>Declination(degrees, minutes, seconds)</code>, при помощи которого можно получить единое вещественное значение из градусов, угловых минут и угловых секунд. </p>
<p>Вот пример создания всем известного Ковша - семи главных звезд Большой Медведицы (координаты из Википедии): </p>
<pre class="gml language-gml"><code class="hljs gml language-gml">SkydomeAddStar(sky, RightAscension(<span class="hljs-number">11</span>, <span class="hljs-number">3</span>, <span class="hljs-number">44</span>), Declination(<span class="hljs-number">61</span>, <span class="hljs-number">45</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.79</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Дубхе</span>
SkydomeAddStar(sky, RightAscension(<span class="hljs-number">11</span>, <span class="hljs-number">1</span>, <span class="hljs-number">50</span>), Declination(<span class="hljs-number">56</span>, <span class="hljs-number">22</span>, <span class="hljs-number">57</span>), <span class="hljs-number">2.37</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Мерак</span>
SkydomeAddStar(sky, RightAscension(<span class="hljs-number">11</span>, <span class="hljs-number">53</span>, <span class="hljs-number">50</span>), Declination(<span class="hljs-number">53</span>, <span class="hljs-number">41</span>, <span class="hljs-number">41</span>), <span class="hljs-number">2.44</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Фекда</span>
SkydomeAddStar(sky, RightAscension(<span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">25</span>), Declination(<span class="hljs-number">57</span>, <span class="hljs-number">01</span>, <span class="hljs-number">57</span>), <span class="hljs-number">3.31</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Мегрец</span>
SkydomeAddStar(sky, RightAscension(<span class="hljs-number">12</span>, <span class="hljs-number">54</span>, <span class="hljs-number">0</span>), Declination(<span class="hljs-number">55</span>, <span class="hljs-number">57</span>, <span class="hljs-number">35</span>), <span class="hljs-number">1.77</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Алиот</span>
SkydomeAddStar(sky, RightAscension(<span class="hljs-number">13</span>, <span class="hljs-number">23</span>, <span class="hljs-number">55</span>), Declination(<span class="hljs-number">54</span>, <span class="hljs-number">55</span>, <span class="hljs-number">31</span>), <span class="hljs-number">2.27</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Мицар</span>
SkydomeAddStar(sky, RightAscension(<span class="hljs-number">13</span>, <span class="hljs-number">47</span>, <span class="hljs-number">32</span>), Declination(<span class="hljs-number">49</span>, <span class="hljs-number">18</span>, <span class="hljs-number">48</span>), <span class="hljs-number">1.86</span>, <span class="hljs-symbol">c_white</span>); <span class="hljs-comment">// Алькаид</span>
</code></pre>
<p>Удобнее будет, конечно, создать что-то вроде звездного каталога в файле и читать его при загрузке, создавая звезды процедурно.</p>
</body>
</html>
