# Partition

Чем больше вы добавляете на сцену объектов, тем медленнее протекает их обработка и рендеринг. В таких ситуациях на отрисовку отправляется слишком много данных о вершинах, в том числе и тех, которые и рисоваться не должны - камера их просто не видит. Что же делать? На помощь приходят методы разбиения пространства. В частности, квадратичные и октарные деревья: Quadtree и Octree.

Рассмотрим принцип действия Octree. Игровой мир вписывается в куб, получившийся куб делится надвое по каждой оси (X,Y,Z). Таким образом, получается, что мир разбит на восемь кубов (отсюда и название Octree – восьмеричное дерево). Далее эти восемь кубов делятся еще на восемь, те еще на восемь и так далее.

Самый большой куб - исходный - называется корнем (root). Все кубы дерева, в том числе и корень – это узлы (node). Узлы, находящиеся в самом низу дерева и хранящие объекты - листья (leaf).

Когда сцена разбита на некоторе количество узлов, и в каждом листе хранятся списки принадлежащих ему объектов, мы, используя пирамиду видимости (frustum), определяем из всех листов те, которые видны камере. А определив их, рисуем только те объекты, которые находятся в кубах этих листьев.

Квадратичное дерево (Quadtree) устроено аналогично, только мир делится не на кубы, а на квадраты. Quadtree больше подходит для разбиения плоских пространств, в которых перемещение камеры ограничено преимущественно некоторой плоскостью: примером может служить автосимулятор.

Деревья могут применяться не только для отбора видимости, но и для оптимизации проверки столкновений. Например, вы можете определять листы, находящиеся внутри некоего ограничивающего параллелепипеда (AABB) или сферы (BSphere).

---

## OctreeCreate

`real OctreeCreate(real maxdepth, real leafthreshold, real growgravy, real culling);`

Создает октарное дерево и возвращает указатель на него.

- `maxdepth` - сведения отсутствуют
- `leafthreshold` - сведения отсутствуют
- `growgravy` - сведения отсутствуют
- `culling` - сведения отсутствуют
    - `cmFineCulling` = 0
    - `cmGrossCulling` = 1.

---

## QuadtreeCreate

`real QuadtreeCreate(real maxdepth, real leafthreshold, real growgravy, real culling);`

Создает квадратичное дерево и возвращает указатель на него.

- `maxdepth` - сведения отсутствуют
- `leafthreshold` - сведения отсутствуют
- `growgravy` - сведения отсутствуют
- `culling` - сведения отсутствуют
    - `cmFineCulling` = 0
    - `cmGrossCulling` = 1.

---

## PartitionDestroy

`real PartitionDestroy(real tree);`

Уничтожает дерево.

- `tree` - указатель на дерево.

---

## PartitionAddLeaf

`real PartitionAddLeaf(real tree, real object);`

Добавляет к дереву объект, который должен участвовать в разбиении.

- `tree` - указатель на дерево
- `object` - указатель на объект.

---

## PartitionLeafChanged

`real PartitionLeafChanged(real object);`

Сведения отсутствуют.

- `object` - указатель на объект.

---

## PartitionQueryFrustrum

`real PartitionQueryFrustrum(real tree, real viewer);`

Запрашивает у дерева все листья, которые видны камере заданного вида.

- `tree` - указатель на дерево
- `viewer` - указатель на вид.

---

## PartitionQueryLeaf

`real PartitionQueryLeaf(real tree, real object);`

Сведения отсутствуют.

- `tree` - указатель на дерево
- `object` - указатель на объект.

---

## PartitionQueryAABB

`real PartitionQueryAABB(real tree, real object);`

Запрашивает у дерева все листья, находящиеся внутри ограничивающего параллелепипеда заданного объекта.

- `tree` - указатель на дерево
- `object` - указатель на объект.

---

## PartitionQueryBSphere

`real PartitionQueryBSphere(real tree, real object);`

Запрашивает у дерева все листья, находящиеся внутри ограничивающей сферы заданного объекта.

- `tree` - указатель на дерево
- `object` - указатель на объект.

---

## PartitionGetNodeTests

`real PartitionGetNodeTests(real tree);`

Сведения отсутствуют.

- `tree` - указатель на дерево.

---

## PartitionGetNodeCount

`real PartitionGetNodeCount(real tree);`

Возвращает общее количество узлов дерева.

- `tree` - указатель на дерево.

---

## PartitionGetResult

`real PartitionGetResult(real tree, real index);`

Возвращает id объекта, принадлежащего заданному листу результата последнего запроса.

- `tree` - указатель на дерево
- `index` - номер листа.

---

## PartitionGetResultCount

`real PartitionGetResultCount(real tree);`

Возвращает количество листьев в результате последнего запроса.

- `tree` - указатель на дерево
- `index` - номер листа.

---

## PartitionResultShow

`real PartitionResultShow(real tree);`

Показывает объекты, принадлежащие листьям результата последнего запроса.

- `tree` - указатель на дерево.

---

## PartitionResultHide

`real PartitionResultHide(real tree);`

Скрывает объекты, принадлежащие листьям результата последнего запроса.

- `tree` - указатель на дерево.
